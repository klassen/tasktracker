// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Tenant {
  id               Int                @id @default(autoincrement())
  name             String             @unique
  password         String             // Hashed password using bcrypt
  createdAt        String             // Local datetime string: YYYY-MM-DD HH:MM:SS
  people           Person[]
  calendarSettings CalendarSettings?
}

model Person {
  id        Int      @id @default(autoincrement())
  name      String
  color     String?  // Hex color for UI display
  pointGoal Int?     // Monthly point goal for this person
  createdAt String   // Local datetime string: YYYY-MM-DD HH:MM:SS
  tenantId  Int
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tasks     Task[]

  @@unique([tenantId, name])
}

model Task {
  id          Int              @id @default(autoincrement())
  title       String
  description String?
  isRecurring Boolean          @default(true) // True for recurring tasks, false for one-off tasks
  activeDays  String           // Days of week when task is active: "0,1,2,3,4,5,6" (0=Sunday, 6=Saturday)
  createdAt   String           // Local datetime string: YYYY-MM-DD HH:MM:SS
  updatedAt   String           // Local datetime string: YYYY-MM-DD HH:MM:SS
  points      Int?             // Optional points value
  money       Float?           // Optional money value
  assignedToId Int?
  assignedTo   Person?         @relation(fields: [assignedToId], references: [id], onDelete: SetNull)
  completions  TaskCompletion[]
}

model TaskCompletion {
  id            Int    @id @default(autoincrement())
  taskId        Int
  task          Task   @relation(fields: [taskId], references: [id], onDelete: Cascade)
  completedDate String // Local date string: YYYY-MM-DD
  createdAt     String // Local datetime string: YYYY-MM-DD HH:MM:SS

  @@unique([taskId, completedDate])
}

model CalendarSettings {
  id               Int      @id @default(autoincrement())
  accessToken      String
  refreshToken     String
  tokenExpiry      String   // Local datetime string: YYYY-MM-DD HH:MM:SS
  selectedCalendars String  // Comma-separated calendar IDs
  createdAt        String   // Local datetime string: YYYY-MM-DD HH:MM:SS
  updatedAt        String   // Local datetime string: YYYY-MM-DD HH:MM:SS
  tenantId         Int      @unique
  tenant           Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}
